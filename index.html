<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/dc@3/dc.css" />
  <script src="https://unpkg.com/d3@5/dist/d3.js"></script>
  <script src="https://unpkg.com/crossfilter2@1.4/crossfilter.js"></script>
  <script src="https://unpkg.com/dc@3/dc.js"></script>
  <script src="https://rawgit.com/crossfilter/reductio/master/reductio.js"></script>
  <script src="https://npmcdn.com/universe@latest/universe.js"></script>
  <link rel="stylesheet" href="styles/dc.css">
  <link rel="stylesheet" href="styles/styles.css">
  <style>
    .dc-chart g.row text {
      fill: #020000;
    }
    .container {
      min-width: 1600px;
    }
    .chart-title {
      font-weight: 500;
    }
  </style>
</head>

<body>
  <h1>Charts here</h1>
  <div class="steak-chart"></div>
  <div class="smoke-chart"></div>
  <div class="drink-chart"></div>
  <div class="cheat-chart"></div>

  <script src="js/crossfilter.js"></script>
  <script src="js/d3.js"></script>
  <script src="js/dc.js"></script>
  <script src="js/underscore-min.js"></script>
  <script type="text/javascript">

  var ndx;

  var steakChart = dc.pieChart("#steak-chart");
  // var smokeChart = dc.rowChart("#smoke-chart");
  // var drinkChart = dc.rowChart("#drink-chart");
  // var cheatChart = dc.rowChart("#cheat-chart");

  d3.csv('steak.csv').then(function(data) {
    console.log('data first length', data.length);
    data = _.filter(data, function(d) { return d.id});
    console.log('data', data.length);
      
 

  ndx = crossfilter(data);
  var all = ndx.groupAll();


var prepSteakDim = ndx.dimension(function(d) { return d["prepSteak"]});
var prepSteakGroup = prepSteakDim.group();

var smokeDim = ndx.dimension(function(d) { return d["smoke"]});
var smokeGroup = smokeDim.group();

var drinkDim = ndx.dimension(function(d) { return d["drink"]});
var drinkGroup = drinkDim.group();

var cheatDim = ndx.dimension(function(d) { return d["cheat"]});
var cheatGroup = cheatDim.group();

var allDim = ndx.dimension(function(d) { return d;});

steakChart
  .width(250)
  .height(250)
  .slicesCap(5)
  .innerRadius(60)
  .dimension(prepSteakDim)
  .group(prepSteakGroup)
  .on('pretransition', function(chart) {
    chart.selectAll('text.pie-slice').text(function(d) {
      return d.data.key + ' '+ dc.ultils.pringSingleValue((d.endAngle - d.startAngle) / (2*Math.PI) * 100) + '%';
    })
  });

  dc.renderAll();
});
  </script>
</body>
</html>
